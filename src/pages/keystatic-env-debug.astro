---
// ç’°å¢ƒè®Šæ•¸èª¿è©¦é é¢ - é¡¯ç¤ºæ‰€æœ‰å¯èƒ½çš„è¨ªå•æ–¹å¼
export const prerender = false;

// æ”¶é›†æ‰€æœ‰å¯èƒ½çš„ç’°å¢ƒè®Šæ•¸è¨ªå•æ–¹å¼
const envData: any = {
  'import.meta.env': {},
  'Astro.locals': {},
  'Astro.locals.runtime': {},
  'context': {}
};

// æ–¹æ³• 1: import.meta.env
try {
  envData['import.meta.env'] = {
    KEYSTATIC_GITHUB_OWNER: import.meta.env.KEYSTATIC_GITHUB_OWNER || 'undefined',
    KEYSTATIC_GITHUB_REPO: import.meta.env.KEYSTATIC_GITHUB_REPO || 'undefined',
    KEYSTATIC_GITHUB_TOKEN: import.meta.env.KEYSTATIC_GITHUB_TOKEN ? 'å·²è¨­ç½®' : 'æœªè¨­ç½®',
    'PUBLIC_*': Object.keys(import.meta.env).filter(k => k.startsWith('PUBLIC_')),
    'æ‰€æœ‰ç’°å¢ƒè®Šæ•¸': Object.keys(import.meta.env)
  };
} catch (e) {
  envData['import.meta.env'] = { error: String(e) };
}

// æ–¹æ³• 2: Astro.locals
try {
  envData['Astro.locals'] = {
    keys: Object.keys(Astro.locals),
    runtime: Astro.locals.runtime ? 'å­˜åœ¨' : 'ä¸å­˜åœ¨'
  };
  
  if (Astro.locals.runtime) {
    const runtime = Astro.locals.runtime as any;
    envData['Astro.locals.runtime'] = {
      env: runtime.env ? Object.keys(runtime.env) : 'ä¸å­˜åœ¨',
      KEYSTATIC_GITHUB_OWNER: runtime.env?.KEYSTATIC_GITHUB_OWNER || 'undefined',
      KEYSTATIC_GITHUB_REPO: runtime.env?.KEYSTATIC_GITHUB_REPO || 'undefined',
      KEYSTATIC_GITHUB_TOKEN: runtime.env?.KEYSTATIC_GITHUB_TOKEN ? 'å·²è¨­ç½®' : 'æœªè¨­ç½®'
    };
  }
} catch (e) {
  envData['Astro.locals'] = { error: String(e) };
}

// æ–¹æ³• 3: context
try {
  const context = (Astro as any).context;
  if (context) {
    envData['context'] = {
      exists: true,
      env: context.env ? Object.keys(context.env) : 'ä¸å­˜åœ¨',
      KEYSTATIC_GITHUB_OWNER: context.env?.KEYSTATIC_GITHUB_OWNER || 'undefined',
      KEYSTATIC_GITHUB_REPO: context.env?.KEYSTATIC_GITHUB_REPO || 'undefined',
      KEYSTATIC_GITHUB_TOKEN: context.env?.KEYSTATIC_GITHUB_TOKEN ? 'å·²è¨­ç½®' : 'æœªè¨­ç½®'
    };
  } else {
    envData['context'] = { exists: false };
  }
} catch (e) {
  envData['context'] = { error: String(e) };
}

console.log('ç’°å¢ƒè®Šæ•¸èª¿è©¦ä¿¡æ¯:', JSON.stringify(envData, null, 2));
---

<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç’°å¢ƒè®Šæ•¸èª¿è©¦</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 1200px;
      margin: 20px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    pre {
      background: #f5f5f5;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      font-size: 12px;
      line-height: 1.5;
    }
    h2 {
      margin-top: 0;
      border-bottom: 2px solid #e5e7eb;
      padding-bottom: 10px;
    }
    .found {
      color: #10b981;
      font-weight: bold;
    }
    .not-found {
      color: #ef4444;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ” ç’°å¢ƒè®Šæ•¸èª¿è©¦é é¢</h1>
    <p>é€™å€‹é é¢é¡¯ç¤ºæ‰€æœ‰å¯èƒ½çš„ç’°å¢ƒè®Šæ•¸è¨ªå•æ–¹å¼ï¼Œå¹«åŠ©è¨ºæ–·å•é¡Œã€‚</p>
  </div>

  <div class="card">
    <h2>1. import.meta.env</h2>
    <pre>{JSON.stringify(envData['import.meta.env'], null, 2)}</pre>
    {envData['import.meta.env'].KEYSTATIC_GITHUB_OWNER !== 'undefined' ? (
      <p class="found">âœ… åœ¨ import.meta.env ä¸­æ‰¾åˆ°ç’°å¢ƒè®Šæ•¸</p>
    ) : (
      <p class="not-found">âŒ åœ¨ import.meta.env ä¸­æœªæ‰¾åˆ°ç’°å¢ƒè®Šæ•¸</p>
    )}
  </div>

  <div class="card">
    <h2>2. Astro.locals</h2>
    <pre>{JSON.stringify(envData['Astro.locals'], null, 2)}</pre>
  </div>

  {envData['Astro.locals'].runtime === 'å­˜åœ¨' && (
    <div class="card">
      <h2>3. Astro.locals.runtime.env</h2>
      <pre>{JSON.stringify(envData['Astro.locals.runtime'], null, 2)}</pre>
      {envData['Astro.locals.runtime'].KEYSTATIC_GITHUB_OWNER !== 'undefined' ? (
        <p class="found">âœ… åœ¨ runtime.env ä¸­æ‰¾åˆ°ç’°å¢ƒè®Šæ•¸</p>
      ) : (
        <p class="not-found">âŒ åœ¨ runtime.env ä¸­æœªæ‰¾åˆ°ç’°å¢ƒè®Šæ•¸</p>
      )}
    </div>
  )}

  <div class="card">
    <h2>4. context</h2>
    <pre>{JSON.stringify(envData['context'], null, 2)}</pre>
    {envData['context'].exists && envData['context'].KEYSTATIC_GITHUB_OWNER !== 'undefined' ? (
      <p class="found">âœ… åœ¨ context.env ä¸­æ‰¾åˆ°ç’°å¢ƒè®Šæ•¸</p>
    ) : (
      <p class="not-found">âŒ åœ¨ context.env ä¸­æœªæ‰¾åˆ°ç’°å¢ƒè®Šæ•¸</p>
    )}
  </div>

  <div class="card">
    <h2>ğŸ“ è¨ºæ–·å»ºè­°</h2>
    <p>è«‹æŸ¥çœ‹ä¸Šé¢çš„è¼¸å‡ºï¼Œæ‰¾åˆ°å“ªå€‹æ–¹æ³•å¯ä»¥è¨ªå•ç’°å¢ƒè®Šæ•¸ã€‚</p>
    <p>å¦‚æœæ‰€æœ‰æ–¹æ³•éƒ½é¡¯ç¤º "undefined" æˆ– "æœªè¨­ç½®"ï¼Œå¯èƒ½æ˜¯ï¼š</p>
    <ol>
      <li>ç’°å¢ƒè®Šæ•¸æœªæ­£ç¢ºè¨­ç½®åœ¨ Cloudflare Pages</li>
      <li>éœ€è¦é‡æ–°éƒ¨ç½²</li>
      <li>ç’°å¢ƒè®Šæ•¸åç¨±æ‹¼å¯«éŒ¯èª¤</li>
      <li>Cloudflare Pages çš„ç’°å¢ƒè®Šæ•¸è¨ªå•æ–¹å¼æœ‰è®ŠåŒ–</li>
    </ol>
  </div>
</body>
</html>

